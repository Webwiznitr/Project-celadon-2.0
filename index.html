<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <link rel="icon" href="images/logo%20webwiz.ico" type="image/png" sizes="16x16">
    <title>Cheladon</title>
    <link rel="stylesheet" media="all" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" />
    <link rel="stylesheet" media="all" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css" />
    <link rel="stylesheet" media="all" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
    <link rel="stylesheet" href="js/pickadate.js/themes/default.css">
    <link rel="stylesheet" href="js/pickadate.js/themes/default.date.css">
    <link rel="stylesheet" href="css/main.css">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/prashantchaudhary/ddslick/master/jquery.ddslick.min.js">
    </script>
    <script type="text/javascript" src="js/pickadate.js/picker.js"></script>
    <script type="text/javascript" src="js/pickadate.js/picker.date.js"></script>
    <script type="text/javascript">
        window.onload = function() {
            // Date picker
            $('#date').pickadate({
                max: new Date()
            });
        }

        // Dropdown plugin data
        var ddData = [{
            text: "Template 1",
            value: "template_1.jpg",
            selected: true,
            description: "Template description",
            imageSrc: "template/template_1.jpg"
        }, {
            text: "Template 2",
            value: "template_2.jpg",
            selected: false,
            description: "Template description",
            imageSrc: "template/template_2.jpg"
        }, {
            text: "Template 3",
            value: "template_3.jpg",
            selected: false,
            description: "Description with LinkedIn",
            imageSrc: "template/template_3.jpg"
        }];
    </script>
</head>

<body>

    <div class="header">

        <!--Content before waves-->
        <div class="inner-header flex">
            <h1>Certificate Generator</h1>
        </div>

        <!--Waves Container-->
        <div>
            <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
                <defs>
                    <path id="gentle-wave"
                        d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
                </defs>
                <g class="parallax">
                    <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7" />
                    <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
                    <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
                    <use xlink:href="#gentle-wave" x="48" y="7" fill="#fff" />
                </g>
            </svg>
        </div>
        <!--Waves end-->
    </div>
    <!--Header ends-->

    <div class="container">
        <div class="row">
            <div class="column">
                <form action="apis/index.php" method="POST" enctype="multipart/form-data">
                    <label for="fname">Person Name</label>
                    <input type="text" id="fname" name="name" placeholder="Name of person">
                    <label for="event">Event Name</label>
                    <input type="text" id="event" name="event" placeholder="Name of Event">
                    <label for="date">Date of issue of certificate:</label><br>
                    <input type="date" id="date" name="date" placeholder="Issue Date"><br><br>
                    <label for="signature">Upload Signature:</label><br>
                    <input type="file" name="Signature" id="Signature" placeholder="Upload Signature">
                    <br><br>
                    <label>Select Template</label>
                    <div id="myDropdown">
                    </div>
                    <br><br>
                    <button type="submit" class="btn btn-success" id="generate-btn" name="submit">Generate
                        Certificate</button>
                </form>
            </div>
            <div class="column">
                <img src="template/template_1.jpg" alt="image " id="template-img" style="width:100%">
            </div>
        </div>
    </div>
    <!-- footer begins -->
    <footer class="new_footer_area bg_color">
        <div class="new_footer_top">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 col-md-6">
                        <div class="f_widget company_widget wow fadeInLeft" data-wow-delay="0.2s" style="visibility: visible; animation-delay: 0.2s; animation-name: fadeInLeft;">
                            <h3 class="f-title f_600 t_color f_size_18">About Us</h3>
                            <p>
                                We at WebWiz, the web development club of National Institute of Technology Rourkela, aspire to meet all your web development needs at your fingertips. We are enthusiastically involved in hackathons, organising workshops and also express the nuances of
                                development by writing tech blogs.
                            </p>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6">
                        <div class="f_widget about-widget pl_70 wow fadeInLeft" data-wow-delay="0.6s" style="visibility: visible; animation-delay: 0.6s; animation-name: fadeInLeft;">
                            <h3 class="f-title f_600 t_color f_size_18">Celadon</h3>
                            <p>
                                This project is made for the purpose of generating certificates with a single click as many as you can. It is completely free and easy to use and made by Team Webwiz with love.
                            </p>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6">
                        <div class="f_widget social-widget pl_70 wow fadeInLeft" data-wow-delay="0.8s" style="visibility: visible; animation-delay: 0.8s; animation-name: fadeInLeft;">
                            <h3 class="f-title f_600 t_color f_size_18">Follow us on social network</h3>
                            <div class="f_social_icon">
                                <a href="https://github.com/Webwiznitr" class="fab fa-github"></a>
                                <a href="https://twitter.com/webwiznitr" class="fab fa-twitter"></a>
                                <a href="https://www.linkedin.com/company/webwiz-nitr/" class="fab fa-linkedin"></a>
                                <a href="https://www.instagram.com/webwiz.nitr/" class="fab fa-instagram"></a>
                            </div>
                            <br>
                            <div>
                                <p>phone number</p>
                                <span>+91 8250901947</span>
                                <p>email address</p>
                                <span style="text-transform: lowercase;"> webwiz.nitrkl@gmail.com</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer_bg">
                <div class="footer_bg_one"></div>
                <div class="footer_bg_two"></div>
            </div>
        </div>
        <div class="footer_bottom">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6 col-sm-7">
                        <p class="mb-0 f_400">
                            <a class="fa fa-copyright"></a> Project-celadon. 2020 All rights reserved.
                        </p>
                    </div>
                    <div class="col-lg-6 col-sm-5 text-right">
                        <div>Made with
                            <a class="fa fa-heart" style="color:#e60606"></a> in <strong>India</strong></div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- footer end -->
</body>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
    //template preview
    var template, fname, event, date, sign;
    $('#myDropdown').ddslick({
        data: ddData,
        width: 400,
        selectText: "Select your template",
        imagePosition: "right",
        onSelected: function(data) {
            //callback function: do something with selectedData;
            // console.log(data.selectedData);
            template = data.selectedData.value;
            $('#template-img').attr('src', "template/" + template);
        }
    });
    // console.log(template);
    $('#view-btn').hide();

    //checks whether form is filled and then uploads
    $("#generate-btn").click(function(e) {
        e.preventDefault();
        var fname = document.getElementById('fname').value;
        var event = document.getElementById('event').value;
        var date = document.getElementById('date').value;
        console.log(template + " " + event + " " + name + " " + date);
        var fd = new FormData();
        var files = $('#Signature')[0].files[0];
        fd.append('file', files);
        console.log(fd);
        $.ajax({
            url: 'apis/signature_upload.php',
            data: fd,
            type: "POST",
            contentType: false,
            processData: false,
            success: function(response) {

                console.log((response));
                var res = JSON.parse(response);
                if (res.status == "success") {
                    swal('signature uploaded', '', 'success').then((
                        value) => {
                        sign = res.result;
                        $.ajax({

                            url: 'apis/index.php',
                            data: {
                                event: event,
                                name: fname,
                                date: date,
                                template: template,
                                sign: sign
                            },
                            type: 'POST',
                            success: function(response) {
                                console.log((response));

                                var res = JSON.parse(response);
                                if (res.status == "success") {
                                    var location = res.message;
                                    swal('Certificate generated', '', 'success')
                                        .then((
                                            value) => {
                                            var file_name = res.result;
                                            // console.log(file_name);

                                            var a = document.createElement(
                                                "a"); //Create <a>
                                            a.href =
                                                "data:image/png;base64," +
                                                file_name; //Image Base64 Goes here
                                            a.download = res.filename +
                                                ".png"; //File name Here
                                            a.click(); //Downloaded file
                                        });
                                } else {
                                    swal(res.message, '', 'error');

                                }
                            }
                        });
                    });

                } else {
                    swal(res.result, '', 'error');
                }
            }
        });
    });
</script>

</html>